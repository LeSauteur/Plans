<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–ª–∞–Ω –ø—Ä–æ–¥–∞–∂ –ø–æ –∫–≤–∞—Ä—Ç–∞–ª–∞–º</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        h1, h2 {
            color: #333;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 30px;
            background-color: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        th, td {
            padding: 12px;
            text-align: center;
            border: 1px solid #ddd;
        }
        th {
            background-color: #4CAF50;
            color: white;
            position: sticky;
            top: 0;
        }
        tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        .negative {
            background-color: #ffcccc;
            font-weight: bold;
        }
        .positive {
            background-color: #ccffcc;
            font-weight: bold;
        }
        .neutral {
            background-color: #ffffcc;
        }
        input {
            width: 90%;
            padding: 5px;
            text-align: center;
        }
        .quarter-summary {
            font-weight: bold;
            background-color: #e0e0e0;
        }
        .half-year-summary {
            font-weight: bold;
            background-color: #d0d0ff;
        }
        .percentage {
            font-size: 0.9em;
            display: block;
            color: #555;
        }
        .office-name {
            text-align: left;
            font-weight: bold;
        }
        .plan-cell {
            background-color: #f0f0f0;
        }
        .action-buttons {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        .btn-print {
            background-color: #007BFF;
            color: white;
        }
        .btn-print:hover {
            background-color: #0056b3;
        }
        .btn-export {
            background-color: #28a745;
            color: white;
        }
        .btn-export:hover {
            background-color: #1e7e34;
        }
        .btn-import {
            background-color: #ffc107;
            color: black;
        }
        .btn-import:hover {
            background-color: #e0a800;
        }
        .readonly-cell {
            background-color: #f9f9f9;
            font-style: italic;
            color: #555;
        }
        @media print {
            .action-buttons {
                display: none;
            }
            body {
                background-color: white;
                margin: 0;
            }
            table {
                box-shadow: none;
            }
        }
    </style>
</head>
<body>
    <h1>–ü–ª–∞–Ω –ø—Ä–æ–¥–∞–∂ –ø–æ –∫–≤–∞—Ä—Ç–∞–ª–∞–º (–ê–ø—Ä–µ–ª—å 2025 - –°–µ–Ω—Ç—è–±—Ä—å 2025)</h1>
    <p><strong>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:</strong> –î–∞–Ω–Ω—ã–µ –∑–∞ –∏—é–ª—å –∏ –∞–≤–≥—É—Å—Ç –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω—ã. –°–µ–Ω—Ç—è–±—Ä—å –≤—Ä–µ–º–µ–Ω–Ω–æ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.</p>
    
    <div class="action-buttons">
        <button class="btn btn-print" onclick="window.print()">üñ®Ô∏è –†–∞—Å–ø–µ—á–∞—Ç–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É</button>
        <button class="btn btn-export" onclick="exportData()">üì§ –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
        <button class="btn btn-import" onclick="document.getElementById('fileInput').click()">üì• –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
        <input type="file" id="fileInput" accept=".json" style="display: none;" onchange="importData(this.files[0])">
    </div>

    <table id="salesTable">
        <thead>
            <tr>
                <th>‚Ññ</th>
                <th>–§–ò–û</th>
                <th>–û—Ñ–∏—Å—ã</th>
                <th>–ü–ª–∞–Ω 1 –ö–≤–∞—Ä—Ç–∞–ª</th>
                <th colspan="3">1 –ö–≤–∞—Ä—Ç–∞–ª (–ê–ø—Ä–µ–ª—å-–ò—é–Ω—å)</th>
                <th>–ò—Ç–æ–≥–æ 1 –ö–≤–∞—Ä—Ç–∞–ª</th>
                <th>–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ 1 –ö–≤–∞—Ä—Ç–∞–ª</th>
                <th>% –í—ã–ø–æ–ª–Ω–µ–Ω–∏—è 1 –ö–≤–∞—Ä—Ç–∞–ª</th>
                <th>–ü–ª–∞–Ω 2 –ö–≤–∞—Ä—Ç–∞–ª</th>
                <th colspan="3">2 –ö–≤–∞—Ä—Ç–∞–ª (–ò—é–ª—å-–°–µ–Ω—Ç—è–±—Ä—å)</th>
                <th>–ò—Ç–æ–≥–æ 2 –ö–≤–∞—Ä—Ç–∞–ª</th>
                <th>–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ 2 –ö–≤–∞—Ä—Ç–∞–ª</th>
                <th>% –í—ã–ø–æ–ª–Ω–µ–Ω–∏—è 2 –∫–≤–∞—Ä—Ç–∞–ª</th>
                <th>–ò—Ç–æ–≥–æ –∑–∞ –ø–æ–ª—É–≥–æ–¥–∏–µ</th>
                <th>–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞ –ø–æ–ª—É–≥–æ–¥–∏–µ</th>
                <th>% –∑–∞ –ø–æ–ª—É–≥–æ–¥–∏–µ</th>
            </tr>
            <tr>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th>–ê–ø—Ä–µ–ª—å</th>
                <th>–ú–∞–π</th>
                <th>–ò—é–Ω—å</th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th>–ò—é–ª—å</th>
                <th>–ê–≤–≥—É—Å—Ç</th>
                <th>–°–µ–Ω—Ç—è–±—Ä—å</th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            <!-- –î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –≤—Å—Ç–∞–≤–ª–µ–Ω—ã —Å—é–¥–∞ JavaScript -->
        </tbody>
    </table>

    <script>
        // –î–∞–Ω–Ω—ã–µ –∏–∑ –ø–µ—Ä–≤–æ–≥–æ –ª–∏—Å—Ç–∞ Excel –∑–∞ –ø–µ—Ä–≤—ã–π –∫–≤–∞—Ä—Ç–∞–ª + –∏—é–ª—å/–∞–≤–≥—É—Å—Ç
        const quarterlyData = [
            { id: 1, name: "–ü–∞–Ω–∞—Å–µ–Ω–∫–æ", offices: "–ü—Ä–µ–º—å–µ—Ä, –ë–∞—Ç–∞–π—Å–∫ 1, –ó–∞–ø–∞–¥–Ω—ã–π 2", planQ1: 3457237, apr: 1352753, may: 1626616, jun: 1412350, totalQ1: 4391719, perfQ1: 934482, jul: 1004894, aug: 386542, sep: 0 },
            { id: 2, name: "–ö–∏–≤–≤–∞", offices: "–°–µ–≤ 3", planQ1: 1755701, apr: 1034500, may: 463000, jun: 882000, totalQ1: 2379500, perfQ1: 623799, jul: 798000, aug: 948000, sep: 0 },
            { id: 3, name: "–ß—É–Ω–æ—Å–æ–≤", offices: "–ó–∞–ø 5", planQ1: 1000000, apr: 364250, may: 0, jun: 170000, totalQ1: 534250, perfQ1: -465750, jul: 651490, aug: 640682, sep: 0 },
            { id: 4, name: "–¢–µ—Ä–∫–∏–Ω", offices: "–ó–∞–ø–∞–¥–Ω—ã–π –û–ª–∏–º–ø, –í–æ–ª–≥–æ–¥–Ω—Å–∫", planQ1: 8648704, apr: 5786215, may: 1949366, jun: 5237950, totalQ1: 12973531, perfQ1: 4324827, jul: 3447725, aug: 4861040, sep: 0 },
            { id: 5, name: "–£–≤–∞—Ä–æ–≤", offices: "–î–æ–º–∏–∞–Ω –ö–æ–º–∞—Ä–æ–≤–∞, –î–æ–º–∏–∞–Ω –°—Ç–∞—á–∫–∏", planQ1: 3019166, apr: 2029200, may: 4982000, jun: 6733285, totalQ1: 13744485, perfQ1: 10725319, jul: 3559969, aug: 1037350, sep: 0 },
            { id: 6, name: "–Ø—Ü—ã–∫", offices: "–í–æ—Å—Ç–æ—á–Ω—ã–π", planQ1: 1000000, apr: 177400, may: 594000, jun: 399000, totalQ1: 1170400, perfQ1: 170400, jul: 255000, aug: 394000, sep: 0 },
            { id: 7, name: "–ë–∞—Ä–∞–Ω–æ–≤–∞", offices: "–®–æ–ª–æ—Ö–æ–≤–∞", planQ1: 1014438, apr: 32200, may: 156500, jun: 624346, totalQ1: 813046, perfQ1: -201392, jul: 286000, aug: 270582, sep: 0 },
            { id: 8, name: "–ì—É–∫–æ–≤", offices: "–ù–∞—Ä–∏–º–∞–Ω–æ–≤–∞, –ê–∫—Å–∞–π –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π", planQ1: 3375064, apr: 564000, may: 1276239, jun: 347000, totalQ1: 2187239, perfQ1: -1187825, jul: 1846000, aug: 1668500, sep: 0 },
            { id: 9, name: "–°–∫–≤–æ—Ä—Ü–æ–≤–∞", offices: "–ü–µ—Ä–≤–æ–º–∞–π—Å–∫–∏–π", planQ1: 3439756, apr: 414500, may: 331200, jun: 376820, totalQ1: 1122520, perfQ1: -2317236, jul: 46250, aug: 0, sep: 0 },
            { id: 10, name: "–ß–µ—Ä–≤–æ–Ω—ã–π", offices: "–°–æ–ª–æ–≤—É—à–∫–∏", planQ1: 2728496, apr: 946212, may: 543300, jun: 1623000, totalQ1: 3112512, perfQ1: 384016, jul: 3136089, aug: 2920400, sep: 0 },
            { id: 11, name: "–®–∏—è–Ω–æ–≤–∞", offices: "–ó–∞–ø–∞–¥–Ω—ã–π 11", planQ1: 1000000, apr: 0, may: 0, jun: 0, totalQ1: 0, perfQ1: -1000000, jul: 0, aug: 106000, sep: 0 },
            { id: 12, name: "–ú–µ–∂–æ–≤", offices: "–Ø–Ω—Ç–∞—Ä–Ω—ã–π, –ê–∫—Å–∞–π, –õ–µ–Ω–∏–Ω–∞–≤–∞–Ω, –õ–µ–≥–µ–∞—Ä—Ç–∏—Å", planQ1: 1648394, apr: 1360000, may: 615575, jun: 192000, totalQ1: 2167575, perfQ1: 519181, jul: 1777300, aug: 2635250, sep: 0 },
            { id: 13, name: "–ß—É–ø—Ä–∏–Ω–∞", offices: "–ì–æ—Ä–∏–∑–æ–Ω—Ç", planQ1: 4081605, apr: 2304300, may: 701750, jun: 387000, totalQ1: 3393050, perfQ1: -688555, jul: 2966016, aug: 938000, sep: 0 },
            { id: 14, name: "–ü–∏—Ä–æ–≥–æ–≤–∞", offices: "–î–∏–Ω–∞—Å—Ç–∏—è", planQ1: 1000000, apr: 0, may: 0, jun: 146000, totalQ1: 146000, perfQ1: -854000, jul: 0, aug: 202000, sep: 0 },
            { id: 15, name: "–°–º–µ—Ö–Ω–æ–≤–∞", offices: "–ü—É—à–∫–∏–Ω—Å–∫–∏–π", planQ1: 1695078, apr: 727875, may: 875500, jun: 684750, totalQ1: 2288125, perfQ1: 593047, jul: 1208000, aug: 1115280, sep: 0 },
            { id: 16, name: "–ì—Ä–∏–±–µ–Ω—é–∫ –°.", offices: "–ì–≤–∞—Ä–¥–µ–π—Å–∫–∏–π", planQ1: 1000000, apr: 0, may: 512000, jun: 0, totalQ1: 512000, perfQ1: -488000, jul: 92880, aug: 311500, sep: 0 },
            { id: 17, name: "–õ–µ–±–µ–¥–µ–≤", offices: "–ù–æ–≤–æ—á–µ—Ä–∫–∞—Å—Å–∫-1", planQ1: 17288268, apr: 3886106, may: 4453800, jun: 7822564, totalQ1: 16162470, perfQ1: -1125798, jul: 3941232, aug: 4928528, sep: 0 },
            { id: 18, name: "–ó–µ–ª–µ–Ω—å–∫–æ–≤", offices: "–ù–æ–≤–æ—á–µ—Ä–∫–∞—Å—Å–∫-2", planQ1: 13702894, apr: 8098293, may: 4197618, jun: 8106403, totalQ1: 20402314, perfQ1: 6699420, jul: 9832435, aug: 5709512, sep: 0 },
            { id: 19, name: "–ü–µ—Ç—Ä–æ–≤—Å–∫–∞—è", offices: "–ú–∞–π—Å–∫–∏–π", planQ1: 1000000, apr: 150000, may: 0, jun: 0, totalQ1: 150000, perfQ1: -850000, jul: 0, aug: 0, sep: 0 },
            { id: 20, name: "–ó–∞–ª–µ—â–µ–Ω–∫–æ", offices: "–í–µ–∫—Ç–æ–† –î–æ–º–∏–∞–Ω", planQ1: 1589806, apr: 810245, may: 850500, jun: 1066205, totalQ1: 2726950, perfQ1: 1137144, jul: 996500, aug: 724000, sep: 0 },
            { id: 21, name: "–ë—Ä–∞–≥–∏–Ω", offices: "–ë–∞—Ç–∞–π—Å–∫-2", planQ1: 1332214, apr: 705000, may: 304410, jun: 92500, totalQ1: 1101910, perfQ1: -230304, jul: 205000, aug: 260000, sep: 0 },
            { id: 22, name: "–ù–µ–º—á–µ–Ω–∫–æ", offices: "–ê–∑–æ–≤ –ü–µ—Ä–≤—ã–π, –ó–æ–ª–æ—Ç–æ–π –ö–≤–∞–¥—Ä–∞—Ç", planQ1: 1000000, apr: 273167, may: 85000, jun: 146750, totalQ1: 504917, perfQ1: -495083, jul: 396600, aug: 628069, sep: 0 },
            { id: 23, name: "–ö–Ω—è–∑–µ–≤", offices: "–°—É–≤–æ—Ä–æ–≤—Å–∫–∏–π-2", planQ1: 1332214, apr: 716000, may: 663625, jun: 562700, totalQ1: 1942325, perfQ1: 610111, jul: 1298500, aug: 847415, sep: 0 },
            { id: 24, name: "–î–∞–Ω–∏–ª–æ–≤–∞ –û.", offices: "–æ—Ñ–∏—Å –î–∞–Ω–∏–ª–æ–≤—ã—Ö", planQ1: 3015870, apr: 227400, may: 0, jun: 150000, totalQ1: 377400, perfQ1: -2638470, jul: 0, aug: 766000, sep: 0 },
            { id: 25, name: "–ö–æ–∑–ª–æ–≤–∞", offices: "–õ–µ–ú–∞—Ä –í–µ—Ä–µ—Å–∞–µ–≤–æ", planQ1: 1038158, apr: 1713576, may: 376500, jun: 575000, totalQ1: 2665076, perfQ1: 1626918, jul: 427350, aug: 1022156, sep: 0 },
            { id: 26, name: "–ö—Ä–∞–≤—Ü–æ–≤", offices: "–†–∞–Ω—Ç—å–µ", planQ1: 2076800, apr: 132000, may: 91000, jun: 0, totalQ1: 223000, perfQ1: -1853800, jul: 0, aug: 432000, sep: 0 },
            { id: 27, name: "–ú–æ–ª—á–∞–Ω–æ–≤", offices: "–†–∏–µ–ª—Ç", planQ1: 1000000, apr: 282000, may: 401000, jun: 422446, totalQ1: 1105446, perfQ1: 105446, jul: 194692, aug: 507000, sep: 0 }
        ];

        const tableBody = document.querySelector('#salesTable tbody');
        const STORAGE_KEY = 'salesPlanDataQ2_2025';

        function formatNumber(num) {
            return new Intl.NumberFormat('ru-RU').format(num);
        }

        function calculatePercentage(actual, plan) {
            if (plan === 0) return "0.00";
            return ((actual - plan) / plan * 100).toFixed(2);
        }

        function getPerformanceClass(value) {
            if (value > 0) return 'positive';
            if (value < 0) return 'negative';
            return 'neutral';
        }

        function createRow(data, savedData = {}) {
            const row = document.createElement('tr');
            
            let html = `
                <td>${data.id}</td>
                <td class="office-name">${data.name}</td>
                <td class="office-name">${data.offices}</td>
                <td class="plan-cell">${formatNumber(data.planQ1)}</td>
                <td>${formatNumber(data.apr)}</td>
                <td>${formatNumber(data.may)}</td>
                <td>${formatNumber(data.jun)}</td>
                <td>${formatNumber(data.totalQ1)}</td>
                <td class="${getPerformanceClass(data.perfQ1)}">${formatNumber(data.perfQ1)}</td>
                <td>${calculatePercentage(data.totalQ1, data.planQ1)}%</td>
            `;
            
            const planQ2 = data.planQ1;
            const savedValues = savedData[data.name] || { sep: 0 };
            
            // --- –í–ê–ñ–ù–û ---
            // –ò—é–ª—å –∏ –ê–≤–≥—É—Å—Ç —Ç–µ–ø–µ—Ä—å –ø—Ä–æ—Å—Ç–æ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–∞–∫ —Ç–µ–∫—Å—Ç, –∞ –Ω–µ –∫–∞–∫ –∏–Ω–ø—É—Ç—ã.
            // –°–µ–Ω—Ç—è–±—Ä—å —Ç–æ–∂–µ read-only, –Ω–æ –µ–≥–æ –º–æ–∂–Ω–æ –ª–µ–≥–∫–æ —Å–¥–µ–ª–∞—Ç—å —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º—ã–º (—Å–º. –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –Ω–∏–∂–µ).
            html += `
                <td class="plan-cell">${formatNumber(planQ2)}</td>
                <td class="readonly-cell">${formatNumber(data.jul)}</td>
                <td class="readonly-cell">${formatNumber(data.aug)}</td>
                <td class="readonly-cell">${formatNumber(savedValues.sep)}</td>
                <td class="quarter-summary">0</td>
                <td class="quarter-summary">0</td>
                <td class="quarter-summary">0%</td>
                <td class="half-year-summary">0</td>
                <td class="half-year-summary">0</td>
                <td class="half-year-summary">0%</td>
            `;
            
            row.innerHTML = html;
            return row;
        }

        // –≠–ö–°–ü–û–†–¢ –î–ê–ù–ù–´–•
        function exportData() {
            const dataToExport = {};
            // –¢–∞–∫ –∫–∞–∫ —Å–µ–Ω—Ç—è–±—Ä—å —Ç–µ–ø–µ—Ä—å –Ω–µ –∏–Ω–ø—É—Ç, –º—ã —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º –µ–≥–æ –∏–∑ localStorage
            const saved = loadSavedData();
            for (const key in saved) {
                if (saved[key].sep !== undefined) {
                    dataToExport[key] = { sep: saved[key].sep };
                }
            }

            const dataStr = JSON.stringify(dataToExport, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `plan_data_${new Date().toISOString().slice(0,10)}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);

            alert('–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã!');
        }

        // –ò–ú–ü–û–†–¢ –î–ê–ù–ù–´–•
        function importData(file) {
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    saveData(importedData); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ —Ç–∞–±–ª–∏—Ü–µ
                    populateTable(importedData);
                    
                    alert('–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã!');
                } catch (error) {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ –¥–∞–Ω–Ω—ã—Ö: ' + error.message);
                    console.error(error);
                }
            };
            reader.readAsText(file);
            document.getElementById('fileInput').value = '';
        }

        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ localStorage
        function loadSavedData() {
            try {
                const saved = localStorage.getItem(STORAGE_KEY);
                return saved ? JSON.parse(saved) : {};
            } catch (e) {
                console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:", e);
                return {};
            }
        }

        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ localStorage
        function saveData(dataToSave = null) {
            if (!dataToSave) {
                // –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω—ã, —Å–æ–±–∏—Ä–∞–µ–º —Ç–µ–∫—É—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è —Å–µ–Ω—Ç—è–±—Ä—è
                dataToSave = {};
                document.querySelectorAll('td[data-name]').forEach(cell => {
                    const name = cell.getAttribute('data-name');
                    const sepText = cell.textContent.replace(/\s/g, '');
                    if (!dataToSave[name]) {
                        dataToSave[name] = {};
                    }
                    dataToSave[name].sep = parseFloat(sepText) || 0;
                });
            }
            
            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(dataToSave));
            } catch (e) {
                console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö:", e);
            }
        }

        // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ç–∞–±–ª–∏—Ü—É –¥–∞–Ω–Ω—ã–º–∏
        function populateTable(savedData = {}) {
            tableBody.innerHTML = '';
            quarterlyData.forEach(data => {
                const row = createRow(data, savedData);
                tableBody.appendChild(row);
                
                // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º —Ä–∞—Å—á–µ—Ç—ã –¥–ª—è —Å—Ç—Ä–æ–∫–∏
                updateCalculationsForRow(row, data, savedData);
            });
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ä–∞—Å—á–µ—Ç–æ–≤ –ø–æ —Å—Ç—Ä–æ–∫–µ
        function updateCalculationsForRow(row, data, savedData) {
            const savedValues = savedData[data.name] || { sep: 0 };
            const sep = parseFloat(savedValues.sep) || 0;
            
            const planQ1 = data.planQ1;
            const planQ2 = data.planQ1;
            
            const totalQ2 = data.jul + data.aug + sep;
            const perfQ2 = totalQ2 - planQ2;
            const percentQ2 = calculatePercentage(totalQ2, planQ2);
            
            // –ù–∞—Ö–æ–¥–∏–º —è—á–µ–π–∫–∏ –ø–æ –∏–Ω–¥–µ–∫—Å—É
            row.cells[14].textContent = formatNumber(totalQ2);
            row.cells[15].textContent = formatNumber(perfQ2);
            row.cells[15].className = getPerformanceClass(perfQ2);
            row.cells[16].textContent = percentQ2 + '%';
            
            const totalHalfYear = data.totalQ1 + totalQ2;
            const planHalfYear = planQ1 + planQ2;
            const perfHalfYear = totalHalfYear - planHalfYear;
            const percentHalfYear = calculatePercentage(totalHalfYear, planHalfYear);
            
            row.cells[17].textContent = formatNumber(totalHalfYear);
            row.cells[18].textContent = formatNumber(perfHalfYear);
            row.cells[18].className = getPerformanceClass(perfHalfYear);
            row.cells[19].textContent = percentHalfYear + '%';
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', () => {
            const savedData = loadSavedData();
            populateTable(savedData);
        });
    </script>
</body>
</html>
